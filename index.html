<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulForge - Forja de Almas</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-dark: #080a0e;
            --bg-card: rgba(22, 25, 32, 0.65);
            /* Glass base */
            --accent: #d4af37;
            --accent-glow: rgba(212, 175, 55, 0.3);
            --accent-dim: #7a6625;
            --text-main: #f0f0f0;
            --text-dim: #9ca3af;
            --border: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            /* Overlay oscuro + Imagen de fondo */
            background-image:
                linear-gradient(rgba(8, 10, 14, 0.85), rgba(8, 10, 14, 0.85)),
                url("/static/images/background.png");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;

            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
        }

        /* Header */
        .hero {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo-img {
            max-width: 500px;
            width: 100%;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.3));
            transition: all 0.5s ease;
        }

        .logo-img:hover {
            filter: drop-shadow(0 0 30px rgba(212, 175, 55, 0.6));
            transform: scale(1.02);
        }

        .tagline {
            color: var(--text-dim);
            font-size: 1.1rem;
            letter-spacing: 8px;
            text-transform: uppercase;
            font-weight: 300;
        }

        .version {
            display: inline-block;
            background: rgba(212, 175, 55, 0.1);
            color: var(--accent);
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 20px;
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .header {
            text-align: center;
        }

        .title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-dim);
            font-weight: 300;
        }

        /* Glass Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .card-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 10px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-desc {
            color: var(--text-dim);
            margin-bottom: 30px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: var(--text-dim);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        input,
        select {
            width: 100%;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }

        /* Pro Buttons */
        .btn-forge {
            width: 100%;
            background: linear-gradient(135deg, #b48d28 0%, #ddb955 100%);
            color: #0b0d12;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 10px 20px -5px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-forge:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 30px -5px rgba(212, 175, 55, 0.5);
        }

        .btn-forge:active {
            transform: translateY(1px);
        }

        /* Range Slider */
        input[type="range"] {
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            border: none;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            transition: transform 0.2s;
        }

        /* Footer */
        .footer {
            margin-top: 80px;
            color: var(--text-dim);
            font-size: 0.9rem;
            opacity: 0.6;
        }

        /* Character Builder */
        .character-builder {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            border: 1px dashed var(--border);
        }

        /* Nav Tabs */
        .nav-tabs {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(22, 25, 32, 0.8);
            border: 1px solid var(--border);
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .nav-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            color: var(--accent);
        }

        .glow-btn {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
            border-color: rgba(212, 175, 55, 0.4);
            color: var(--accent);
        }

        .glow-btn:hover {
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 100%);
        }

        /* ========== MOBILE RESPONSIVE ========== */
        @media (max-width: 768px) {
            body {
                padding: 20px 12px;
            }

            .hero {
                margin-bottom: 30px;
            }

            .logo {
                font-size: 2.2rem;
                letter-spacing: 4px;
            }

            .tagline {
                font-size: 0.8rem;
                letter-spacing: 4px;
            }

            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header {
                margin-bottom: 10px !important;
            }

            .title {
                font-size: 1.3rem;
            }

            .subtitle {
                font-size: 0.8rem;
            }

            .lang-selector {
                padding: 8px 12px !important;
            }

            .lang-selector a {
                font-size: 1.3rem !important;
                margin: 0 5px !important;
            }

            .card {
                padding: 18px;
                border-radius: 16px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .card-desc {
                font-size: 0.8rem;
                margin-bottom: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                font-size: 0.7rem;
                margin-bottom: 6px;
            }

            input,
            select {
                padding: 10px;
                font-size: 0.85rem;
            }

            .btn-forge {
                padding: 14px;
                font-size: 0.9rem;
                letter-spacing: 1px;
            }

            /* ===== FORCE ALL GRIDS TO SINGLE COLUMN ===== */
            .mobile-grid-stack,
            [style*="grid-template-columns: 1fr 1fr"],
            [style*="grid-template-columns: repeat(3"],
            [style*="grid-template-columns: repeat(2"] {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            /* Character row fields - stack vertically */
            .character-row {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 8px;
                margin-bottom: 15px !important;
            }

            .character-row>div:first-child {
                margin: 0 auto 5px auto;
            }

            /* Steps section - vertical */
            div[style*="repeat(3, 1fr)"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 20px !important;
            }

            div[style*="repeat(3, 1fr)"]>div {
                padding: 15px !important;
            }

            /* Feature list - single column */
            div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }

            /* Demo section grids */
            div[style*="grid-template-columns: 1fr 1fr"][style*="gap: 40px"] {
                display: block !important;
            }

            div[style*="grid-template-columns: 1fr 1fr"][style*="gap: 40px"]>div {
                margin-bottom: 20px;
            }

            /* Reduce margins on sections */
            div[style*="margin-top: 80px"] {
                margin-top: 40px !important;
            }

            div[style*="margin-top: 60px"] {
                margin-top: 30px !important;
            }

            /* Character builder scroll area */
            .character-builder {
                max-height: none !important;
                overflow-y: visible !important;
            }

            /* Version badge */
            .version {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            /* Credits display */
            #creditsDisplay {
                font-size: 0.8rem;
                padding: 6px 12px !important;
            }

            /* Price labels */
            [id*="priceLabel"] {
                font-size: 1rem !important;
            }

            /* Demo section titles */
            h2[style*="font-size: 2rem"] {
                font-size: 1.4rem !important;
            }

            h2[style*="font-size: 2.5rem"] {
                font-size: 1.6rem !important;
            }

            /* Quote blocks */
            p[style*="font-size: 1.2rem"] {
                font-size: 1rem !important;
            }
        }

        /* Extra small screens (phones in portrait) */
        @media (max-width: 480px) {
            body {
                padding: 15px 8px;
            }

            .logo {
                font-size: 1.6rem;
                letter-spacing: 2px;
            }

            .tagline {
                font-size: 0.65rem;
                letter-spacing: 2px;
            }

            .card {
                padding: 12px;
                border-radius: 12px;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .btn-forge {
                padding: 12px;
                font-size: 0.8rem;
            }

            input,
            select {
                padding: 8px;
                font-size: 0.8rem;
            }

            /* Hide less important sections on very small screens */
            .demo-section-hide-mobile {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="hero">
        <div class="logo-container">
            <img src="/static/images/logo_web.png" alt="SoulForge - Forja de Almas" class="logo-img">
        </div>
        <div class="tagline" data-i18n="hero_tagline">Soul Forging System</div>
        <span class="version">v4.0 - Complete System</span>

        <!-- Credits Display -->
        <div id="creditsDisplay"
            style="margin-top: 20px; display: none; background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(34, 197, 94, 0.3); font-weight: bold;">
            ğŸ Modo Prueba: <span id="creditsCount">0</span> usos gratis restantes
        </div>
    </div>

    <div class="container">
        <div class="header" style="grid-column: 1 / -1; margin-bottom: 20px;">
            <h1 class="title" data-i18n="index_title">SoulForge Engine</h1>

            <p class="subtitle" data-i18n="index_subtitle">Procedural Narrative Generation & Deep Psychology System</p>
            <div class="lang-selector"
                style="margin-top: 25px; background: rgba(0,0,0,0.4); display: inline-block; padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border);">
                <a href="#es" onclick="changeLanguage('es')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;"
                    title="EspaÃ±ol">ğŸ‡ªğŸ‡¸</a>
                <a href="#en" onclick="changeLanguage('en')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;"
                    title="English">ğŸ‡ºğŸ‡¸</a>
                <a href="#jp" onclick="changeLanguage('jp')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;" title="æ—¥æœ¬èª">ğŸ‡¯ğŸ‡µ</a>
            </div>

            <!-- NAV TABS -->
            <div class="nav-tabs">
                <a href="https://soulforge.up.railway.app/" target="_blank" class="nav-btn">
                    API Root
                </a>
                <a href="juego_en_linea.html" class="nav-btn glow-btn">
                    Jugar en LÃ­nea (VTT)
                </a>
                <button type="button" class="nav-btn" onclick="alert('Sistema de Registro de Tokens en desarrollo.')">
                    ğŸª™ Mis Tokens
                </button>
            </div>
        </div>

        <!-- PERSONAJE ÃšNICO -->
        <div class="card">
            <h2 class="card-title" data-i18n="card_alma_title">âš”ï¸ Forge Soul</h2>
            <p class="card-desc" data-i18n="card_alma_desc">Create a unique character with psychological depth.</p>

            <form id="formPersonaje" onsubmit="return handleForjarAlma(event)">
                <input type="hidden" name="lang" id="inputLangPersonaje" value="es">
                <div class="form-group">
                    <label data-i18n="label_nombre">CHARACTER NAME</label>
                    <input type="text" name="nombre" id="inputNombre" data-i18n-placeholder="label_nombre_placeholder"
                        placeholder="Ex: Kael (empty = random)">
                </div>

                <div class="mobile-grid-stack" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label data-i18n="genero">GENDER</label>
                        <select name="genero">
                            <option value="">-- Random --</option>
                            <option value="Masculino">Masculino/Male</option>
                            <option value="Femenino">Femenino/Female</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="rol">ROLE</label>
                        <select name="rol" id="rolSelect" onchange="toggleRaceField()">
                            <option value="">-- Random --</option>
                            <option value="Heroe">Hero</option>
                            <option value="Villano">Villain</option>
                            <option value="Mentor">Mentor</option>
                            <option value="Aliado">Ally</option>
                            <option value="Jugador">âœ¨ Player (D&D/RPG)</option>
                            <option value="Bufon">Jester</option>
                            <option value="Victima">Victim</option>
                            <option value="Profeta">Prophet</option>
                            <option value="Guardian">Guardian</option>
                            <option value="Embaucador">Trickster</option>
                        </select>
                    </div>

                    <div class="form-group" id="razaGroup" style="display: none;">
                        <label>Raza (D&D)</label>
                        <select name="raza">
                            <option value="">-- Random --</option>
                            <option value="Humano">Human</option>
                            <option value="Elfo">Elf</option>
                            <option value="Enano">Dwarf</option>
                            <option value="Halfling">Halfling</option>
                            <option value="Dragonborn">Dragonborn</option>
                            <option value="Gnomo">Gnome</option>
                            <option value="Tiefling">Tiefling</option>
                            <option value="Orco">Orc</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label data-i18n="edad">AGE</label>
                    <input type="number" name="edad_fija" placeholder="30 (Optional)" min="5" max="900">
                </div>

                <div class="form-group">
                    <label data-i18n="label_mundo">WORLD</label>
                    <select name="mundo">
                        <option value="FantasiaMedieval">Medieval Fantasy</option>
                        <option value="FantasiaOscura">Dark Fantasy</option>
                        <option value="FantasiaUrbana">Urban Fantasy</option>
                        <option value="SciFiCyberpunk">Cyberpunk</option>
                        <option value="SciFiSpace">Sci-Fi Space Opera</option>
                        <option value="SciFiPostApocaliptico">Post-Apocalyptic</option>
                        <option value="Steampunk">Steampunk</option>
                        <option value="Western">Western</option>
                        <option value="Noir">Noir / Detective</option>
                        <option value="Realista">Realistic</option>
                        <option value="JaponFeudal">Feudal Japan</option>
                        <option value="ChinaImperial">Imperial China</option>
                        <option value="CoreaHistorica">Historical Korea</option>
                        <option value="MitologiaAsiatica">Asian Mythology</option>
                        <option value="AnimeFantasia">Anime Fantasy</option>
                        <option value="Wuxia">Wuxia</option>
                        <option value="Victoriano">Victorian Era</option>
                        <option value="MitologiaGriega">Greek Mythology</option>
                        <option value="MitologiaNordica">Norse Mythology</option>
                        <option value="PiratasCaribe">Pirates</option>
                    </select>
                </div>

                <div class="form-group">
                    <label data-i18n="label_tono">TONE</label>
                    <select name="tono_moral">
                        <option value="">-- Random --</option>
                        <option value="Luminoso">Luminous/Good</option>
                        <option value="Gris">Grey/Moral Ambiguity</option>
                        <option value="Oscuro">Dark</option>
                    </select>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="submit" id="btnPersonaje" class="btn-forge">
                        <span style="font-size: 1.2rem;">âš¡</span> <span data-i18n="btn_forjar_alma">FORGE SOUL</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- CONSTELACIÃ“N -->
        <div class="card">
            <h2 class="card-title" data-i18n="card_constelacion_title">ğŸŒŒ Forge Constellation</h2>
            <p class="card-desc" data-i18n="card_constelacion_desc">Generate a group of interconnected characters.</p>

            <form id="formConstelacion" onsubmit="return handleForjarConstelacion(event)">
                <input type="hidden" name="lang" id="inputLangConstelacion" value="es">
                <input type="hidden" name="nombres" id="nombresHidden">
                <input type="hidden" name="generos" id="generosHidden">
                <input type="hidden" name="edades" id="edadesHidden">

                <!-- Slider de cantidad -->
                <div class="form-group">
                    <label data-i18n="label_tamano_grupo">GROUP SIZE</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="range" name="cantidad" id="cantidadSlider" min="2" max="4" value="3"
                            oninput="updateCharacterFields()" style="flex: 1;">
                        <span id="cantidadValue"
                            style="font-weight: bold; color: var(--accent); width: 30px; text-align: center; font-size: 1.2rem;">3</span>
                    </div>
                </div>

                <!-- Campos dinÃ¡micos de personajes -->
                <div class="character-builder" style="max-height: 250px; overflow-y: auto; margin-bottom: 20px;">
                    <h4 style="color: var(--text-dim); margin-bottom: 15px;" data-i18n="label_personalizar">Personalize
                    </h4>
                    <div id="characterFields">
                        <!-- JS llenarÃ¡ esto -->
                    </div>
                </div>

                <!-- Opciones avanzadas -->
                <div class="mobile-grid-stack" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label data-i18n="label_motivacion_villano">VILLAIN MOTIVATION</label>
                        <select name="tipo_villano">
                            <option value="None">Random / None</option>
                            <option value="Envidia">Envy</option>
                            <option value="Ideologia">Ideology</option>
                            <option value="Obstaculo">Obstacle</option>
                            <option value="PuraMaldad">Pure Evil</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_romance">ROMANCE</label>
                        <select name="modo_romance">
                            <option value="None">Random / None</option>
                            <option value="Pareja">Couple</option>
                            <option value="Triangulo">Triangle</option>
                            <option value="AmorProhibido">Forbidden Love</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_mundo">WORLD</label>
                        <select name="mundo">
                            <option value="FantasiaMedieval">Medieval Fantasy</option>
                            <option value="FantasiaOscura">Dark Fantasy</option>
                            <option value="FantasiaUrbana">Urban Fantasy</option>
                            <option value="SciFiCyberpunk">Cyberpunk</option>
                            <option value="SciFiSpace">Sci-Fi Space Opera</option>
                            <option value="SciFiPostApocaliptico">Post-Apocalyptic</option>
                            <option value="Steampunk">Steampunk</option>
                            <option value="Western">Western</option>
                            <option value="Noir">Noir / Detective</option>
                            <option value="Realista">Realistic</option>
                            <option value="JaponFeudal">Feudal Japan</option>
                            <option value="ChinaImperial">Imperial China</option>
                            <option value="CoreaHistorica">Historical Korea</option>
                            <option value="MitologiaAsiatica">Asian Mythology</option>
                            <option value="AnimeFantasia">Anime Fantasy</option>
                            <option value="Wuxia">Wuxia</option>
                            <option value="Victoriano">Victorian Era</option>
                            <option value="MitologiaGriega">Greek Mythology</option>
                            <option value="MitologiaNordica">Norse Mythology</option>
                            <option value="PiratasCaribe">Pirates</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_densidad">DENSITY</label>
                        <select name="densidad_relaciones">
                            <option value="Normal">Normal</option>
                            <option value="Densa">Dense</option>
                            <option value="Dispersa">Sparse</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="submit" id="btnConstelacion" class="btn-forge" onclick="prepareSubmit()">
                        <span style="font-size: 1.2rem;">âš¡</span> <span data-i18n="btn_forjar_constelacion">FORGE
                            CONSTELLATION</span>
                    </button>
                    <p style="color: var(--text-dim); font-size: 0.8rem; margin-top: 10px;">
                        The process starts immediately.
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- HOW IT WORKS SECTION -->
    <div style="width: 100%; max-width: 1200px; margin-top: 80px;">
        <div style="text-align: center; margin-bottom: 50px;">
            <h2 style="font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 15px;"
                data-i18n="how_it_works_title">How Does It Work?</h2>
            <p style="color: var(--text-dim); font-size: 1.1rem;" data-i18n="how_it_works_subtitle">Your journey from
                idea to character.</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">âš™ï¸</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step1_title">1. Configure</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step1_desc">Select gender, setting... or
                    leave it random.</p>
            </div>
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ”¥</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step2_title">2. Forge</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step2_desc">The AI generates deep
                    psychology and history.</p>
            </div>
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“¥</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step3_title">3. Download</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step3_desc">Get a premium HTML file
                    ready to use.</p>
            </div>
        </div>
    </div>


    <!-- CHARACTER DEMOS SECTION -->
    <div style="width: 100%; max-width: 1200px; margin-top: 100px;">
        <div style="text-align: center; margin-bottom: 50px;">
            <h2 style="font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 15px;"
                data-i18n="demos_title">Character Examples</h2>
            <p style="color: var(--text-dim); font-size: 1.1rem;" data-i18n="demos_subtitle">See the depth and
                complexity.</p>
        </div>

        <div style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
            <!-- Demo 1 -->
            <div
                style="background: linear-gradient(145deg, rgba(20,20,25,0.9), rgba(10,10,15,0.95)); padding: 25px; border-radius: 12px; border: 1px solid var(--border); width: 350px;">
                <div
                    style="height: 150px; background: #222; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; border: 1px solid #333;">
                    <span style="font-size: 3rem;">ğŸ›¡ï¸</span>
                </div>
                <h3 style="color: var(--text-main); margin-bottom: 10px;" data-i18n="demo_1_name">Aric, The Fallen
                    Paladin</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <span
                        style="background: #331010; color: #ff8888; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #552020;">Dark
                        Fantasy</span>
                    <span
                        style="background: #333; color: #ccc; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #444;">Human</span>
                </div>
                <button class="btn-forge" style="width: 100%; font-size: 0.9rem; padding: 10px;"
                    onclick="window.open('/static/demo_aric.pdf', '_blank')">
                    <span data-i18n="demo_btn">View Example</span> ğŸ“„
                </button>
            </div>

            <!-- Demo 2 -->
            <div
                style="background: linear-gradient(145deg, rgba(20,20,25,0.9), rgba(10,10,15,0.95)); padding: 25px; border-radius: 12px; border: 1px solid var(--border); width: 350px;">
                <div
                    style="height: 150px; background: #222; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; border: 1px solid #333;">
                    <span style="font-size: 3rem;">ğŸ”®</span>
                </div>
                <h3 style="color: var(--text-main); margin-bottom: 10px;" data-i18n="demo_2_name">Elara, The Sorceress
                </h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <span
                        style="background: #101033; color: #8888ff; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #202055;">High
                        Magic</span>
                    <span
                        style="background: #333; color: #ccc; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #444;">Elf</span>
                </div>
                <button class="btn-forge" style="width: 100%; font-size: 0.9rem; padding: 10px;"
                    onclick="window.open('/static/demo_elara.pdf', '_blank')">
                    <span data-i18n="demo_btn">View Example</span> ğŸ“„
                </button>
            </div>
        </div>
    </div>

    <!-- FAQ SECTION -->
    <div style="width: 100%; max-width: 800px; margin-top: 100px; margin-bottom: 50px;">
        <h2 style="font-family: 'Cinzel', serif; font-size: 2rem; color: var(--accent); margin-bottom: 40px; text-align: center;"
            data-i18n="faq_title">FAQ</h2>

        <div style="display: flex; flex-direction: column; gap: 20px;">
            <!-- Q1 -->
            <div
                style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border-left: 3px solid var(--accent);">
                <h3 style="color: var(--text-main); font-size: 1.1rem; margin-bottom: 10px;" data-i18n="faq_q1">Is it
                    free?</h3>
                <p style="color: var(--text-dim); line-height: 1.5;" data-i18n="faq_a1">Yes, completely free for basic
                    usage.</p>
            </div>
            <!-- Q2 -->
            <div
                style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border-left: 3px solid var(--accent);">
                <h3 style="color: var(--text-main); font-size: 1.1rem; margin-bottom: 10px;" data-i18n="faq_q2">
                    Commercial
                    use?</h3>
                <p style="color: var(--text-dim); line-height: 1.5;" data-i18n="faq_a2">Yes, you own the characters.</p>
            </div>
            <!-- Q3 -->
            <div
                style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border-left: 3px solid var(--accent);">
                <h3 style="color: var(--text-main); font-size: 1.1rem; margin-bottom: 10px;" data-i18n="faq_q3">Saved
                    characters?</h3>
                <p style="color: var(--text-dim); line-height: 1.5;" data-i18n="faq_a3">No, we value privacy. Download
                    them.</p>
            </div>
        </div>
    </div>


    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- DISCLAIMER & FOOTER -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div
        style="width: 100%; max-width: 800px; margin: 60px auto 20px; text-align: center; color: var(--text-dim); font-size: 0.75rem; line-height: 1.6;">
        <strong style="color: var(--accent); display: block; margin-bottom: 10px; text-transform: uppercase;"
            data-i18n="aviso_legal_titulo">
            Legal Notice
        </strong>
        <p style="margin-bottom: 10px;" data-i18n="aviso_legal_1">SoulForge is an assisted creation tool.</p>
        <p style="margin-bottom: 10px;" data-i18n="aviso_legal_2">Characters are dynamically generated.</p>
        <p style="margin-bottom: 10px;" data-i18n="aviso_legal_3">It is user responsibility to download the file.</p>
        <p data-i18n="aviso_legal_4">Usage implies results may vary.</p>
    </div>

    <div class="footer" id="top">
        <p data-i18n="footer_dev">Developed with â¤ï¸ by DAITHON BENEDICTUS</p>
    </div>

    <!-- I18N SYSTEM -->
    <script>
        // Dictionary from Rust struct
        const I18N = {
            "en": {
                "hero_tagline": "Soul Forging System",
                "index_title": "SoulForge Engine",
                "index_subtitle": "Procedural Narrative Generation & Deep Psychology System",
                "card_alma_title": "âš”ï¸ Forge Soul",
                "card_alma_desc": "Create a unique character with psychological depth, history, and internal conflicts.",
                "label_nombre": "Character Name (Optional)",
                "label_nombre_placeholder": "Ex: Kael Shadowgreen (empty = random)",
                "label_mundo": "World / Setting",
                "label_tono": "Moral Tone",
                "btn_forjar_alma": "Forge Soul",
                "card_constelacion_title": "ğŸŒŒ Forge Constellation",
                "card_constelacion_desc": "Generate a group of interconnected characters with relationships, conflicts, and shared history.",
                "label_tamano_grupo": "Group Size",
                "label_personalizar": "Personalize Characters",
                "label_motivacion_villano": "Antagonist Motivation",
                "label_romance": "Romantic Dynamic",
                "label_densidad": "Relationship Density",
                "btn_forjar_constelacion": "Forge Constellation",
                "how_it_works_title": "How Does SoulForge Work?",
                "how_it_works_subtitle": "Your journey from idea to complete character in 3 simple steps",
                "step1_title": "Configure",
                "step1_desc": "Select gender, setting, moral tone and archetype. Leave fields empty for surprises.",
                "step2_title": "Forge",
                "step2_desc": "Our AI engine generates complete biography, deep psychology, wounds, conflicts and narrative arc.",
                "step3_title": "Download",
                "step3_desc": "Receive your character in premium HTML format, ready to print, save as PDF or integrate into your story.",
                "demos_title": "Character Examples",
                "demos_subtitle": "See the depth and complexity of our generated profiles",
                "demo_1_name": "Aric, The Fallen Paladin",
                "demo_2_name": "Elara, The Cyber-Hacker",
                "demo_btn": "Preview Character",
                "faq_title": "Frequently Asked Questions",
                "faq_q1": "Is SoulForge really free?",
                "faq_a1": "Yes. We offer a generous free tier. We use a token system for advanced features or heavy volume.",
                "faq_q2": "Can I use the characters commercially?",
                "faq_a2": "Absolutely. Once the character is forged, it belongs to you. You can use it in novels, RPG campaigns, or video games.",
                "faq_q3": "Does the system save my characters?",
                "faq_a3": "No. For privacy, everything is generated instantly and delivered to you. If you close the tab without downloading, it is lost forever.",
                "aviso_legal_titulo": "Legal Notice",
                "aviso_legal_1": "SoulForge is an assisted creation tool based on procedural generation.",
                "aviso_legal_2": "Characters and stories are generated dynamically and appear only in your browser/download.",
                "aviso_legal_3": "It is the user's responsibility to download and preserve the generated file.",
                "aviso_legal_4": "System results may vary between executions.",
                "footer_dev": "Developed with â¤ï¸ by DAITHON BENEDICTUS",
                "genero": "Gender",
                "rol": "Role",
                "edad": "Age"
            },
            "jp": {
                "hero_tagline": "é­‚ã®é›é€ ã‚·ã‚¹ãƒ†ãƒ ",
                "index_title": "SoulForge ã‚¨ãƒ³ã‚¸ãƒ³",
                "index_subtitle": "æ‰‹ç¶šãå‹ç‰©èªç”Ÿæˆã¨æ·±å±¤å¿ƒç†ã‚·ã‚¹ãƒ†ãƒ ",
                "card_alma_title": "âš”ï¸ é­‚ã‚’é›é€ ã™ã‚‹",
                "card_alma_desc": "å¿ƒç†çš„ãªæ·±ã¿ã€æ­´å²ã€å†…éƒ¨å¯¾ç«‹ã‚’æŒã¤ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚",
                "label_nombre": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åï¼ˆä»»æ„ï¼‰",
                "label_nombre_placeholder": "ä¾‹ï¼šã‚«ã‚¨ãƒ«ï¼ˆç©ºæ¬„ï¼ãƒ©ãƒ³ãƒ€ãƒ ï¼‰",
                "label_mundo": "ä¸–ç•Œè¨­å®š",
                "label_tono": "é“å¾³çš„ãªãƒˆãƒ¼ãƒ³",
                "btn_forjar_alma": "é­‚ã‚’é›é€ ",
                "card_constelacion_title": "ğŸŒŒ æ˜Ÿåº§ã‚’é›é€ ã™ã‚‹",
                "card_constelacion_desc": "é–¢ä¿‚ã€å¯¾ç«‹ã€å…±æœ‰ã•ã‚ŒãŸæ­´å²ã‚’æŒã¤ç›¸äº’æ¥ç¶šã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚",
                "label_tamano_grupo": "ã‚°ãƒ«ãƒ¼ãƒ—ã‚µã‚¤ã‚º",
                "label_personalizar": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º",
                "label_motivacion_villano": "æ•µå¯¾è€…ã®å‹•æ©Ÿ",
                "label_romance": "ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹",
                "label_densidad": "é–¢ä¿‚ã®å¯†åº¦",
                "btn_forjar_constelacion": "æ˜Ÿåº§ã‚’é›é€ ",
                "how_it_works_title": "SoulForgeã®ä»•çµ„ã¿",
                "how_it_works_subtitle": "ã‚¢ã‚¤ãƒ‡ã‚¢ã‹ã‚‰å®Œæˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¾ã§3ã¤ã®ç°¡å˜ãªã‚¹ãƒ†ãƒƒãƒ—",
                "step1_title": "è¨­å®š",
                "step1_desc": "æ€§åˆ¥ã€è¨­å®šã€é“å¾³çš„ãƒˆãƒ¼ãƒ³ã€å…ƒå‹ã‚’é¸æŠã€‚ç©ºæ¬„ã«ã™ã‚‹ã¨ã‚µãƒ—ãƒ©ã‚¤ã‚ºãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚",
                "step2_title": "é›é€ ",
                "step2_desc": "AIã‚¨ãƒ³ã‚¸ãƒ³ãŒå®Œå…¨ãªä¼è¨˜ã€æ·±å±¤å¿ƒç†ã€å‚·ã€å¯¾ç«‹ã€ç‰©èªã®ã‚¢ãƒ¼ã‚¯ã‚’ç”Ÿæˆã—ã¾ã™ã€‚",
                "step3_title": "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                "step3_desc": "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ HTMLå½¢å¼ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å—ã‘å–ã‚Šã€å°åˆ·ã€PDFä¿å­˜ã€ã¾ãŸã¯ç‰©èªã«çµ±åˆã§ãã¾ã™ã€‚",
                "demos_title": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¾‹",
                "demos_subtitle": "ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æ·±ã¿ã¨è¤‡é›‘ã•ã‚’ã”è¦§ãã ã•ã„",
                "demo_1_name": "ã‚¢ãƒªãƒƒã‚¯ï¼ˆå •ã¡ãŸè–é¨å£«ï¼‰",
                "demo_2_name": "ã‚¨ãƒ©ãƒ©ï¼ˆã‚µã‚¤ãƒãƒ¼ãƒãƒƒã‚«ãƒ¼ï¼‰",
                "demo_btn": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
                "faq_title": "ã‚ˆãã‚ã‚‹è³ªå•",
                "faq_q1": "SoulForgeã¯æœ¬å½“ã«ç„¡æ–™ã§ã™ã‹ï¼Ÿ",
                "faq_a1": "ã¯ã„ã€‚å¯›å¤§ãªç„¡æ–™æ ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚é«˜åº¦ãªæ©Ÿèƒ½ã‚„å¤§é‡ç”Ÿæˆã«ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚",
                "faq_q2": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å•†ç”¨åˆ©ç”¨ã§ãã¾ã™ã‹ï¼Ÿ",
                "faq_a2": "ã‚‚ã¡ã‚ã‚“ã§ã™ã€‚é›é€ ã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ã‚ãªãŸã®ã‚‚ã®ã§ã™ã€‚å°èª¬ã€RPGã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã€ãƒ“ãƒ‡ã‚ªã‚²ãƒ¼ãƒ ãªã©ã§è‡ªç”±ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚",
                "faq_q3": "ã‚·ã‚¹ãƒ†ãƒ ã¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ",
                "faq_a3": "ã„ã„ãˆã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®ãŸã‚ã€ã™ã¹ã¦å³åº§ã«ç”Ÿæˆã•ã‚Œã€ã‚ãªãŸã«é…ä¿¡ã•ã‚Œã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã›ãšã«ã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹ã¨ã€æ°¸é ã«å¤±ã‚ã‚Œã¾ã™ã€‚",
                "aviso_legal_titulo": "æ³•çš„é€šçŸ¥",
                "aviso_legal_1": "SoulForgeã¯æ‰‹ç¶šãå‹ç”Ÿæˆã«åŸºã¥ãå‰µä½œæ”¯æ´ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚",
                "aviso_legal_2": "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ç‰©èªã¯å‹•çš„ã«ç”Ÿæˆã•ã‚Œã€ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã«ã®ã¿å­˜åœ¨ã—ã¾ã™ã€‚",
                "aviso_legal_3": "ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ä¿å­˜ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è²¬ä»»ã¨ãªã‚Šã¾ã™ã€‚",
                "aviso_legal_4": "ã‚·ã‚¹ãƒ†ãƒ ã®çµæœã¯å®Ÿè¡Œã”ã¨ã«ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
                "footer_dev": "Developed with â¤ï¸ by DAITHON BENEDICTUS",
                "genero": "æ€§åˆ¥",
                "rol": "å½¹å‰²",
                "edad": "å¹´é½¢"
            },
            "es": {
                "hero_tagline": "Sistema de Forja de Almas",
                "index_title": "SoulForge Engine",
                "index_subtitle": "Sistema de GeneraciÃ³n Procedural de Narrativa y PsicologÃ­a Profunda",
                "card_alma_title": "âš”ï¸ Forjar Alma",
                "card_alma_desc": "Crea un personaje Ãºnico con profundidad psicolÃ³gica, historia y conflictos internos.",
                "label_nombre": "Nombre del Personaje (Opcional)",
                "label_nombre_placeholder": "Ej: Kael Sombraverde (vacÃ­o = aleatorio)",
                "label_mundo": "Mundo / AmbientaciÃ³n",
                "label_tono": "Tono Moral",
                "btn_forjar_alma": "Forjar Alma",
                "card_constelacion_title": "ğŸŒŒ Forjar ConstelaciÃ³n",
                "card_constelacion_desc": "Genera un grupo de personajes interconectados con relaciones, conflictos y una historia compartida.",
                "label_tamano_grupo": "TamaÃ±o del Grupo",
                "label_personalizar": "Personalizar Personajes",
                "label_motivacion_villano": "MotivaciÃ³n Antagonista",
                "label_romance": "DinÃ¡mica RomÃ¡ntica",
                "label_densidad": "Densidad de Relaciones",
                "btn_forjar_constelacion": "Forjar ConstelaciÃ³n",
                "how_it_works_title": "Â¿CÃ³mo Funciona SoulForge?",
                "how_it_works_subtitle": "Tu viaje de la idea al personaje completo en 3 simples pasos",
                "step1_title": "Configura",
                "step1_desc": "Selecciona el gÃ©nero, ambientaciÃ³n, tono moral y arquetipo. Deja campos vacÃ­os para sorpresas.",
                "step2_title": "Forja",
                "step2_desc": "Nuestro motor de IA genera biografÃ­a completa, psicologÃ­a profunda, heridas, conflictos y arco narrativo.",
                "step3_title": "Descarga",
                "step3_desc": "Recibe tu personaje en formato HTML premium, listo para imprimir, guardar como PDF o integrar en tu historia.",
                "demos_title": "Ejemplos de Personajes",
                "demos_subtitle": "Descubre la profundidad y complejidad de nuestros perfiles",
                "demo_1_name": "Aric, El PaladÃ­n CaÃ­do",
                "demo_2_name": "Elara, La Cyber-Hacker",
                "demo_btn": "Ver Personaje",
                "faq_title": "Preguntas Frecuentes",
                "faq_q1": "Â¿Es SoulForge realmente gratis?",
                "faq_a1": "SÃ­. Ofrecemos un nivel gratuito generoso. Usamos un sistema de tokens para funciones avanzadas o alto volumen.",
                "faq_q2": "Â¿Puedo usar los personajes comercialmente?",
                "faq_a2": "Absolutamente. Una vez forjado, el personaje te pertenece. Puedes usarlo en novelas, campaÃ±as de rol o videojuegos.",
                "faq_q3": "Â¿El sistema guarda mis personajes?",
                "faq_a3": "No. Por privacidad, todo se genera al instante y se te entrega. Si cierras la pestaÃ±a sin descargar, se pierde para siempre.",
                "aviso_legal_titulo": "Aviso Legal",
                "aviso_legal_1": "SoulForge es una herramienta de creaciÃ³n asistida basada en generaciÃ³n procedural e inteligencia artificial.",
                "aviso_legal_2": "Los personajes e historias se generan dinÃ¡micamente y no se almacenan en nuestros servidores.",
                "aviso_legal_3": "Es responsabilidad del usuario descargar y conservar el archivo generado.",
                "aviso_legal_4": "El uso del sistema implica la aceptaciÃ³n de que los resultados pueden variar entre ejecuciones.",
                "footer_dev": "Desarrollado con â¤ï¸ por DAITHON BENEDICTUS",
                "genero": "GÃ©nero",
                "rol": "Rol",
                "edad": "Edad"
            }
        };

        const OPTION_TRANSLATIONS = {
            'en': {
                '': '-- Random --', 'None': '-- Random / None --', 'Masculino': 'Male', 'Femenino': 'Female',
                'Heroe': 'Hero', 'Villano': 'Villain', 'Mentor': 'Mentor', 'Aliado': 'Ally',
                'Bufon': 'Jester', 'Victima': 'Victim', 'Profeta': 'Prophet', 'Guardian': 'Guardian', 'Embaucador': 'Trickster',
                'Luminoso': 'Luminous / Good', 'Claro': 'Light', 'Gris': 'Grey / Neutral', 'Oscuro': 'Dark', 'Abismal': 'Abyssal / Evil',
                'Envidia': 'Envy', 'Ideologia': 'Ideology', 'Obstaculo': 'Simple Obstacle', 'PuraMaldad': 'Pure Evil',
                'Pareja': 'Couple', 'Triangulo': 'Triangle', 'AmorProhibido': 'Forbidden Love',
                'FantasiaMedieval': 'Medieval Fantasy', 'FantasiaOscura': 'Dark Fantasy', 'FantasiaUrbana': 'Urban Fantasy',
                'SciFiCyberpunk': 'Cyberpunk', 'SciFiSpace': 'Space Opera', 'SciFiPostApocaliptico': 'Post-Apocalyptic',
                'Steampunk': 'Steampunk', 'Western': 'Western', 'Noir': 'Noir', 'Realista': 'Realistic',
                'JaponFeudal': 'Feudal Japan (Sengoku)', 'ChinaImperial': 'Imperial China', 'CoreaHistorica': 'Historical Korea (Joseon)',
                'MitologiaAsiatica': 'Asian Mythology', 'AnimeFantasia': 'Anime Fantasy', 'Wuxia': 'Wuxia / Martial Arts',
                'Victoriano': 'Victorian Era', 'MitologiaGriega': 'Greek Mythology', 'MitologiaNordica': 'Norse Mythology', 'PiratasCaribe': 'Pirates',
                'Normal': 'Relationship Density: Normal', 'Densa': 'Dense', 'Dispersa': 'Sparse'
            },
            'jp': {
                '': '-- ãƒ©ãƒ³ãƒ€ãƒ  --', 'None': '-- ãƒ©ãƒ³ãƒ€ãƒ  / ç„¡ã— --', 'Masculino': 'ç”·æ€§', 'Femenino': 'å¥³æ€§',
                'Heroe': 'è‹±é›„ (Hero)', 'Villano': 'æ‚ªå½¹ (Villain)', 'Mentor': 'å¸«åŒ  (Mentor)', 'Aliado': 'å‘³æ–¹ (Ally)',
                'Bufon': 'é“åŒ–å¸« (Jester)', 'Victima': 'çŠ ç‰²è€… (Victim)', 'Profeta': 'äºˆè¨€è€… (Prophet)', 'Guardian': 'å®ˆè­·è€… (Guardian)', 'Embaucador': 'ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼',
                'Luminoso': 'å…‰ (Good)', 'Claro': 'æ˜', 'Gris': 'ç°è‰² (Neutral)', 'Oscuro': 'é—‡ (Dark)', 'Abismal': 'æ·±æ·µ (Evil)',
                'Envidia': 'å«‰å¦¬', 'Ideologia': 'ã‚¤ãƒ‡ã‚ªãƒ­ã‚®ãƒ¼', 'Obstaculo': 'éšœå®³', 'PuraMaldad': 'ç´”ç²‹æ‚ª',
                'Pareja': 'ã‚«ãƒƒãƒ—ãƒ«', 'Triangulo': 'ä¸‰è§’é–¢ä¿‚', 'AmorProhibido': 'ç¦æ–­ã®æ„›',
                'FantasiaMedieval': 'ä¸­ä¸–ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'FantasiaOscura': 'ãƒ€ãƒ¼ã‚¯ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'FantasiaUrbana': 'ç¾ä»£ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼',
                'SciFiCyberpunk': 'ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯', 'SciFiSpace': 'ã‚¹ãƒšãƒ¼ã‚¹ã‚ªãƒšãƒ©', 'SciFiPostApocaliptico': 'ãƒã‚¹ãƒˆã‚¢ãƒã‚«ãƒªãƒ—ã‚¹',
                'Steampunk': 'ã‚¹ãƒãƒ¼ãƒ ãƒ‘ãƒ³ã‚¯', 'Western': 'è¥¿éƒ¨åŠ‡', 'Noir': 'ãƒãƒ¯ãƒ¼ãƒ« / æ¢åµ', 'Realista': 'ç¾å®Ÿçš„',
                'JaponFeudal': 'æˆ¦å›½æ™‚ä»£ / æ™‚ä»£åŠ‡', 'ChinaImperial': 'ä¸­è¯å¸åœ‹', 'CoreaHistorica': 'æœé®®æ™‚ä»£',
                'MitologiaAsiatica': 'ã‚¢ã‚¸ã‚¢ç¥è©±', 'AnimeFantasia': 'ã‚¢ãƒ‹ãƒ¡ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'Wuxia': 'æ­¦ä¿ ',
                'Victoriano': 'ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢æœ', 'MitologiaGriega': 'ã‚®ãƒªã‚·ãƒ£ç¥è©±', 'MitologiaNordica': 'åŒ—æ¬§ç¥è©±', 'PiratasCaribe': 'æµ·è³Š',
                'Normal': 'é–¢ä¿‚å¯†åº¦ï¼šæ™®é€š', 'Densa': 'å¯†', 'Dispersa': 'ç–'
            },
            'es': {
                '': '-- Random --', 'None': '-- Aleatorio / Ninguno --', 'Masculino': 'Masculino', 'Femenino': 'Femenino',
                'Heroe': 'HÃ©roe', 'Villano': 'Villano', 'Mentor': 'Mentor', 'Aliado': 'Aliado',
                'Bufon': 'BufÃ³n', 'Victima': 'VÃ­ctima', 'Profeta': 'Profeta', 'Guardian': 'GuardiÃ¡n', 'Embaucador': 'Embaucador',
                'Luminoso': 'Luminoso', 'Claro': 'Claro', 'Gris': 'Gris', 'Oscuro': 'Oscuro', 'Abismal': 'Abismal',
                'Envidia': 'Envidia', 'Ideologia': 'IdeologÃ­a', 'Obstaculo': 'ObstÃ¡culo', 'PuraMaldad': 'Pura Maldad',
                'Pareja': 'Pareja', 'Triangulo': 'TriÃ¡ngulo', 'AmorProhibido': 'Amor Prohibido',
                'FantasiaMedieval': 'FantasÃ­a Medieval', 'FantasiaOscura': 'FantasÃ­a Oscura', 'FantasiaUrbana': 'FantasÃ­a Urbana',
                'SciFiCyberpunk': 'Cyberpunk', 'SciFiSpace': 'Space Opera', 'SciFiPostApocaliptico': 'Post-ApocalÃ­ptico',
                'Steampunk': 'Steampunk', 'Western': 'Western', 'Noir': 'Noir', 'Realista': 'Realista',
                'JaponFeudal': 'JapÃ³n Feudal', 'ChinaImperial': 'China Imperial', 'CoreaHistorica': 'Corea HistÃ³rica',
                'MitologiaAsiatica': 'MitologÃ­a AsiÃ¡tica', 'AnimeFantasia': 'Anime FantasÃ­a', 'Wuxia': 'Wuxia',
                'Victoriano': 'Victoriano', 'MitologiaGriega': 'MitologÃ­a Griega', 'MitologiaNordica': 'MitologÃ­a NÃ³rdica', 'PiratasCaribe': 'Piratas del Caribe',
                'Normal': 'Densidad: Normal', 'Densa': 'Densa', 'Dispersa': 'Dispersa'
            }
        };

        function changeLanguage(lang) {
            // Validate language
            if (!['es', 'en', 'jp'].includes(lang)) lang = 'es';

            // Update URL hash without scrolling
            history.replaceState(null, null, '#' + lang);

            // 1. Text Content
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (I18N[lang] && I18N[lang][key]) {
                    el.textContent = I18N[lang][key];
                }
            });

            // 2. Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (I18N[lang] && I18N[lang][key]) {
                    el.placeholder = I18N[lang][key];
                }
            });

            // 3. Select Options Translation
            const dict = OPTION_TRANSLATIONS[lang];
            if (dict) {
                document.querySelectorAll('select').forEach(sel => {
                    Array.from(sel.options).forEach(opt => {
                        // Original value logic relies on knowing the original key, which is the value attribute
                        if (dict[opt.value]) {
                            opt.textContent = dict[opt.value];
                        }
                    });
                });
            }

            // 4. Update hidden inputs for form submission
            document.getElementById('inputLangPersonaje').value = lang;
            document.getElementById('inputLangConstelacion').value = lang;

            // 5. Update Opacity of Selectors
            document.querySelectorAll('.lang-selector a').forEach(a => {
                if (a.getAttribute('href') === '#' + lang) {
                    a.style.opacity = '1';
                } else {
                    a.style.opacity = '0.4';
                }
            });

            // Update character fields labels if they exist
            updateCharacterFields();
        }

        // Initialize
        window.addEventListener('load', () => {
            // Check hash
            let lang = window.location.hash.replace('#', '') || 'es';
            changeLanguage(lang);
        });

        function toggleRaceField() {
            const rol = document.getElementById('rolSelect').value;
            const race = document.getElementById('razaGroup');
            if (rol === 'Jugador') {
                race.style.display = 'block';
            } else {
                race.style.display = 'none';
            }
        }

        function updateCharacterFields() {
            const cantidad = document.getElementById('cantidadSlider').value;
            document.getElementById('cantidadValue').textContent = cantidad;

            const container = document.getElementById('characterFields');

            // Capture current values to preserve them
            const currentValues = {};
            container.querySelectorAll('.character-row').forEach(row => {
                const idx = row.querySelector('.num') ? row.querySelector('.num').textContent.replace('#', '') : null;
                if (idx) {
                    currentValues[idx] = {
                        nombre: row.querySelector(`input[id^="nombre"]`).value,
                        edad: row.querySelector(`input[id^="edad"]`).value,
                        genero: row.querySelector(`select[id^="genero"]`).value
                    };
                }
            });

            container.innerHTML = '';

            // Get current lang for labels
            let lang = document.getElementById('inputLangConstelacion').value || 'es';
            // Simple label mapping for dynamic fields
            const lblName = (lang === 'jp') ? 'åå‰' : (lang === 'en' ? 'Name' : 'Nombre');
            const lblAge = (lang === 'jp') ? 'å¹´é½¢' : (lang === 'en' ? 'Age' : 'Edad');
            const lblGen = (lang === 'jp') ? 'æ€§åˆ¥' : (lang === 'en' ? 'Gender' : 'GÃ©nero');
            const optM = (lang === 'jp') ? 'ç”·' : (lang === 'en' ? 'M' : 'M');
            const optF = (lang === 'jp') ? 'å¥³' : (lang === 'en' ? 'F' : 'F');


            for (let i = 1; i <= cantidad; i++) {
                const prev = currentValues[i] || { nombre: '', edad: '', genero: '' };
                const row = document.createElement('div');
                row.className = 'character-row';
                row.innerHTML = `
                    <span class="num" style="display:none">#${i}</span>
                    <strong style="color:var(--accent); margin-right:5px;">#${i}</strong>
                    <input type="text" id="nombre${i}" value="${prev.nombre}" placeholder="${lblName}" style="flex: 2;">
                    <input type="number" id="edad${i}" value="${prev.edad}" placeholder="${lblAge}" min="10" max="900" style="width: 70px;">
                    <select id="genero${i}" style="flex: 1;">
                        <option value="" ${prev.genero === '' ? 'selected' : ''}>${lblGen}</option>
                        <option value="M" ${prev.genero === 'M' ? 'selected' : ''}>${optM}</option>
                        <option value="F" ${prev.genero === 'F' ? 'selected' : ''}>${optF}</option>
                    </select>
                `;
                container.appendChild(row);
            }
        }

        function prepareSubmit() {
            const cantidad = document.getElementById('cantidadSlider').value;
            const nombres = [];
            const generos = [];
            const edades = [];

            for (let i = 1; i <= cantidad; i++) {
                const nombre = document.getElementById(`nombre${i}`).value.trim();
                const genero = document.getElementById(`genero${i}`).value;
                const edad = document.getElementById(`edad${i}`).value;

                nombres.push(nombre || '');
                generos.push(genero || '');
                edades.push(edad || '');
            }

            document.getElementById('nombresHidden').value = nombres.join(',');
            document.getElementById('generosHidden').value = generos.join(',');
            document.getElementById('edadesHidden').value = edades.join(',');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SOULFORGE ENGINE - COMPLETE SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const API_BASE = 'https://soulforge.up.railway.app';
        const PAYPAL_ME_LINK = 'https://paypal.me/YOURPAYPAL/5'; // CAMBIAR POR TU LINK

        // --- TOKEN SYSTEM ---
        function getTokens() {
            return parseInt(localStorage.getItem('soulforge_tokens') || '0');
        }
        function setTokens(n) {
            localStorage.setItem('soulforge_tokens', n.toString());
            updateTokenDisplay();
        }
        function useToken() {
            const current = getTokens();
            if (current > 0) {
                setTokens(current - 1);
                return true;
            }
            return false;
        }
        function updateTokenDisplay() {
            const display = document.getElementById('creditsDisplay');
            const count = document.getElementById('creditsCount');
            const tokens = getTokens();
            if (tokens > 0) {
                display.style.display = 'block';
                count.textContent = tokens;
            } else {
                display.style.display = 'none';
            }
        }

        // --- PAYPAL MODAL ---
        function showPayPalModal(type) {
            const lang = document.getElementById('inputLangPersonaje').value || 'es';
            const texts = {
                es: {
                    title: 'ğŸ’³ Acceso Premium Requerido',
                    desc: 'Para forjar este ' + (type === 'alma' ? 'personaje' : 'grupo') + ', necesitas un token VIP.',
                    price: 'Precio: $5 USD = 5 Tokens',
                    btn: 'Pagar con PayPal',
                    token: 'Â¿Ya pagaste? Ingresa tu cÃ³digo:',
                    tokenBtn: 'Activar Token',
                    close: 'Cancelar'
                },
                en: {
                    title: 'ğŸ’³ Premium Access Required',
                    desc: 'To forge this ' + (type === 'alma' ? 'character' : 'group') + ', you need a VIP token.',
                    price: 'Price: $5 USD = 5 Tokens',
                    btn: 'Pay with PayPal',
                    token: 'Already paid? Enter your code:',
                    tokenBtn: 'Activate Token',
                    close: 'Cancel'
                },
                jp: {
                    title: 'ğŸ’³ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦',
                    desc: 'ã“ã®' + (type === 'alma' ? 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼' : 'ã‚°ãƒ«ãƒ¼ãƒ—') + 'ã‚’é›é€ ã™ã‚‹ã«ã¯VIPãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™ã€‚',
                    price: 'ä¾¡æ ¼: $5 USD = 5ãƒˆãƒ¼ã‚¯ãƒ³',
                    btn: 'PayPalã§æ”¯æ‰•ã†',
                    token: 'æ”¯æ‰•ã„æ¸ˆã¿ï¼Ÿã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›:',
                    tokenBtn: 'ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æœ‰åŠ¹åŒ–',
                    close: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
                }
            };
            const t = texts[lang] || texts.es;

            const modal = document.createElement('div');
            modal.id = 'paypalModal';
            modal.innerHTML = `
                <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:9999;display:flex;align-items:center;justify-content:center;">
                    <div style="background:#1a1a1f;border:2px solid var(--accent);border-radius:16px;padding:40px;max-width:450px;text-align:center;">
                        <h2 style="color:var(--accent);margin-bottom:20px;font-family:'Cinzel',serif;">${t.title}</h2>
                        <p style="color:var(--text-dim);margin-bottom:20px;">${t.desc}</p>
                        <p style="color:#4ade80;font-weight:bold;margin-bottom:30px;">${t.price}</p>
                        
                        <a href="${PAYPAL_ME_LINK}" target="_blank" 
                           style="display:block;background:#0070ba;color:white;padding:15px 30px;border-radius:8px;text-decoration:none;font-weight:bold;margin-bottom:20px;">
                            ğŸ…¿ï¸ ${t.btn}
                        </a>
                        
                        <div style="border-top:1px solid #333;padding-top:20px;margin-top:20px;">
                            <p style="color:var(--text-dim);font-size:0.9rem;margin-bottom:10px;">${t.token}</p>
                            <input type="text" id="tokenInput" placeholder="XXXX-XXXX-XXXX" 
                                   style="width:100%;padding:12px;background:#0a0a0f;border:1px solid #333;border-radius:8px;color:white;text-align:center;margin-bottom:10px;">
                            <button onclick="activateToken('${type}')" 
                                    style="width:100%;padding:12px;background:var(--accent);color:#000;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">
                                ${t.tokenBtn}
                            </button>
                        </div>
                        
                        <button onclick="closePayPalModal()" 
                                style="margin-top:20px;background:transparent;border:1px solid #555;color:#888;padding:10px 30px;border-radius:8px;cursor:pointer;">
                            ${t.close}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closePayPalModal() {
            const modal = document.getElementById('paypalModal');
            if (modal) modal.remove();
        }

        function activateToken(type) {
            const code = document.getElementById('tokenInput').value.trim().toUpperCase();
            // Simple validation - in production this would check against a server
            if (code.length >= 8) {
                setTokens(getTokens() + 5); // Add 5 tokens
                closePayPalModal();
                alert('âœ… Token activado! Tienes ' + getTokens() + ' usos disponibles.');
                // Retry the forge
                if (type === 'alma') {
                    document.getElementById('formPersonaje').dispatchEvent(new Event('submit'));
                } else {
                    document.getElementById('formConstelacion').dispatchEvent(new Event('submit'));
                }
            } else {
                alert('âŒ CÃ³digo invÃ¡lido. Verifica tu token.');
            }
        }

        // --- LOADING OVERLAY ---
        function showLoading(message) {
            const overlay = document.createElement('div');
            overlay.id = 'loadingOverlay';
            overlay.innerHTML = `
                <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:9998;display:flex;flex-direction:column;align-items:center;justify-content:center;">
                    <div style="width:60px;height:60px;border:4px solid #333;border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;"></div>
                    <p style="color:var(--accent);margin-top:20px;font-family:'Cinzel',serif;">${message}</p>
                </div>
                <style>@keyframes spin{to{transform:rotate(360deg);}}</style>
            `;
            document.body.appendChild(overlay);
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.remove();
        }

        // --- MAIN FORGE HANDLERS ---
        async function handleForjarAlma(event) {
            event.preventDefault();

            // Check tokens
            if (getTokens() <= 0) {
                showPayPalModal('alma');
                return false;
            }

            // Use a token
            useToken();

            // Get form data
            const form = document.getElementById('formPersonaje');
            const formData = new FormData(form);
            const params = new URLSearchParams(formData).toString();

            showLoading('Forjando alma...');

            try {
                const response = await fetch(`${API_BASE}/api/v1/personaje?${params}`);
                if (!response.ok) throw new Error('Error del servidor');

                const personaje = await response.json();
                hideLoading();

                // Generate and show HTML
                showPersonajeHTML(personaje);

            } catch (error) {
                hideLoading();
                alert('Error al forjar: ' + error.message);
                // Refund token on error
                setTokens(getTokens() + 1);
            }

            return false;
        }

        async function handleForjarConstelacion(event) {
            event.preventDefault();
            prepareSubmit(); // Prepare hidden fields

            // Check tokens (constellation costs 2)
            if (getTokens() < 2) {
                showPayPalModal('constelacion');
                return false;
            }

            // Use tokens
            setTokens(getTokens() - 2);

            // Get form data
            const form = document.getElementById('formConstelacion');
            const formData = new FormData(form);
            const params = new URLSearchParams(formData).toString();

            showLoading('Forjando constelaciÃ³n...');

            try {
                const response = await fetch(`${API_BASE}/api/v1/constelacion?${params}`);
                if (!response.ok) throw new Error('Error del servidor');

                const constelacion = await response.json();
                hideLoading();

                // Generate and show HTML
                showConstelacionHTML(constelacion);

            } catch (error) {
                hideLoading();
                alert('Error al forjar: ' + error.message);
                // Refund tokens on error
                setTokens(getTokens() + 2);
            }

            return false;
        }

        // --- HTML GENERATORS ---
        function showPersonajeHTML(p) {
            const lang = document.getElementById('inputLangPersonaje').value || 'es';
            const html = generatePersonajeHTML(p, lang);

            // Open in new window
            const win = window.open('', '_blank');
            win.document.write(html);
            win.document.close();
        }

        function generatePersonajeHTML(p, lang) {
            return `<!DOCTYPE html>
<html lang="${lang}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${p.nombre || 'Personaje'} - SoulForge</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital@0;1&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #d4af37; --bg: #0a0a0f; --card: #12121a; --text: #e8e6e3; --dim: #888; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Crimson Text', serif; line-height: 1.7; padding: 40px 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid var(--accent); padding-bottom: 30px; }
        .name { font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 10px; }
        .meta { color: var(--dim); font-size: 1rem; }
        .section { background: var(--card); border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #222; }
        .section-title { font-family: 'Cinzel', serif; color: var(--accent); font-size: 1.3rem; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .section p { margin-bottom: 12px; }
        .tag { display: inline-block; background: #1a1a25; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; margin: 3px; border: 1px solid #333; }
        .psychology-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .psychology-item { background: #0a0a10; padding: 15px; border-radius: 8px; }
        .psychology-label { color: var(--accent); font-size: 0.9rem; margin-bottom: 5px; }
        .footer { text-align: center; color: var(--dim); font-size: 0.8rem; margin-top: 40px; padding-top: 20px; border-top: 1px solid #222; }
        .download-btn { display: inline-block; background: var(--accent); color: #000; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 20px; cursor: pointer; }
        @media print { .download-btn { display: none; } body { background: white; color: black; } .section { border: 1px solid #ccc; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="name">${p.nombre || 'Sin Nombre'}</h1>
            <p class="meta">${p.genero || ''} Â· ${p.edad || '?'} aÃ±os Â· ${p.mundo || 'FantasÃ­a'}</p>
            <p class="meta">${p.rol || ''} Â· ${p.tono_moral || ''}</p>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ“œ BiografÃ­a</h2>
            <p>${p.biografia || p.bio || 'Historia por descubrir...'}</p>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ§  PsicologÃ­a Profunda</h2>
            <div class="psychology-grid">
                <div class="psychology-item">
                    <div class="psychology-label">MÃ¡scara (Lo que muestra)</div>
                    <p>${p.mascara || p.psicologia?.mascara || 'â€”'}</p>
                </div>
                <div class="psychology-item">
                    <div class="psychology-label">Sombra (Lo que oculta)</div>
                    <p>${p.sombra || p.psicologia?.sombra || 'â€”'}</p>
                </div>
                <div class="psychology-item">
                    <div class="psychology-label">Herida Core</div>
                    <p>${p.herida || p.psicologia?.herida || 'â€”'}</p>
                </div>
                <div class="psychology-item">
                    <div class="psychology-label">Deseo Profundo</div>
                    <p>${p.deseo || p.psicologia?.deseo || 'â€”'}</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ­ Mentira & Verdad</h2>
            <p><strong>Mentira que cree:</strong> ${p.mentira || p.psicologia?.mentira || 'â€”'}</p>
            <p><strong>Verdad que necesita:</strong> ${p.verdad || p.psicologia?.verdad || 'â€”'}</p>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ“ˆ Arco Narrativo</h2>
            <p>${p.arco_narrativo || p.arco || 'Arco por definir...'}</p>
        </div>

        ${p.atributos ? `
        <div class="section">
            <h2 class="section-title">âš”ï¸ Atributos (D&D)</h2>
            <div style="display:flex;flex-wrap:wrap;gap:10px;">
                ${Object.entries(p.atributos).map(([k, v]) => `<span class="tag">${k}: ${v}</span>`).join('')}
            </div>
        </div>
        ` : ''}

        <div class="footer">
            <p>Generado por SoulForge Engine Â· ${new Date().toLocaleDateString()}</p>
            <button class="download-btn" onclick="window.print()">ğŸ“¥ Guardar como PDF</button>
        </div>
    </div>
</body>
</html>`;
        }

        function showConstelacionHTML(c) {
            const lang = document.getElementById('inputLangConstelacion').value || 'es';
            // For constellation, redirect to the dedicated page or generate inline
            const html = generateConstelacionHTML(c, lang);
            const win = window.open('', '_blank');
            win.document.write(html);
            win.document.close();
        }

        function generateConstelacionHTML(c, lang) {
            const personajes = c.personajes || c.characters || [];
            const personajesHTML = personajes.map((p, i) => `
                <div class="character-card">
                    <h3 style="color:var(--accent);font-family:'Cinzel',serif;">${p.nombre || 'Personaje ' + (i + 1)}</h3>
                    <p style="color:var(--dim);">${p.genero || ''} Â· ${p.edad || '?'} aÃ±os</p>
                    <p>${p.biografia || p.bio || ''}</p>
                </div>
            `).join('');

            return `<!DOCTYPE html>
<html lang="${lang}">
<head>
    <meta charset="UTF-8">
    <title>ConstelaciÃ³n - SoulForge</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #d4af37; --bg: #0a0a0f; --card: #12121a; --text: #e8e6e3; --dim: #888; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Crimson Text', serif; padding: 40px 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { font-family: 'Cinzel', serif; color: var(--accent); text-align: center; margin-bottom: 40px; }
        .character-card { background: var(--card); padding: 25px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #222; }
        .footer { text-align: center; color: var(--dim); margin-top: 40px; }
        .download-btn { display: inline-block; background: var(--accent); color: #000; padding: 12px 30px; border-radius: 8px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŒ ConstelaciÃ³n de Personajes</h1>
        ${personajesHTML}
        <div class="footer">
            <p>Generado por SoulForge Engine</p>
            <button class="download-btn" onclick="window.print()">ğŸ“¥ Guardar como PDF</button>
        </div>
    </div>
</body>
</html>`;
        }

        // --- INIT ---
        window.addEventListener('load', () => {
            updateTokenDisplay();
            // Give 3 free tokens for new users
            if (localStorage.getItem('soulforge_tokens') === null) {
                setTokens(3);
            }
        });
    </script>
</body>

</html>