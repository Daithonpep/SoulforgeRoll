<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulForge - Forja de Almas</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK (v9 compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- FirebaseUI -->
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />

    <script>
        // CONFIGURACI√ìN DE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyD7hlbOrBZ5ZtxVw0cPxoBJ0zhrbIG_iA",
            authDomain: "soulforge-46225.firebaseapp.com",
            projectId: "soulforge-46225",
            storageBucket: "soulforge-46225.firebasestorage.app",
            messagingSenderId: "170327957641",
            appId: "1:170327957641:web:f084dc67c2eaa619f4e658"
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    <style>
        :root {
            --bg-dark: #080a0e;
            --bg-card: rgba(22, 25, 32, 0.65);
            /* Glass base */
            --accent: #d4af37;
            --accent-glow: rgba(212, 175, 55, 0.3);
            --accent-dim: #7a6625;
            --text-main: #f0f0f0;
            --text-dim: #9ca3af;
            --border: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: var(--bg-dark);
            /* Overlay oscuro + Imagen de fondo */
            background-image:
                linear-gradient(rgba(8, 10, 14, 0.85), rgba(8, 10, 14, 0.85)),
                url("/static/images/background.png");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;

            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
        }

        /* Header */
        .hero {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo-img {
            max-width: 500px;
            width: 100%;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.3));
            transition: all 0.5s ease;
        }

        .logo-img:hover {
            filter: drop-shadow(0 0 30px rgba(212, 175, 55, 0.6));
            transform: scale(1.02);
        }

        .tagline {
            color: var(--text-dim);
            font-size: 1.1rem;
            letter-spacing: 8px;
            text-transform: uppercase;
            font-weight: 300;
        }

        .version {
            display: inline-block;
            background: rgba(212, 175, 55, 0.1);
            color: var(--accent);
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 20px;
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .header {
            text-align: center;
        }

        .title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--text-main);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-dim);
            font-weight: 300;
        }

        /* Glass Cards */
        .card {
            background: var(--bg-card);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .card-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 10px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-desc {
            color: var(--text-dim);
            margin-bottom: 30px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: var(--text-dim);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        input,
        select {
            width: 100%;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }

        /* Pro Buttons */
        .btn-forge {
            width: 100%;
            background: linear-gradient(135deg, #b48d28 0%, #ddb955 100%);
            color: #0b0d12;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 10px 20px -5px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-forge:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 30px -5px rgba(212, 175, 55, 0.5);
        }

        .btn-forge:active {
            transform: translateY(1px);
        }

        /* Range Slider */
        input[type="range"] {
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            border: none;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            transition: transform 0.2s;
        }

        /* Footer */
        .footer {
            margin-top: 80px;
            color: var(--text-dim);
            font-size: 0.9rem;
            opacity: 0.6;
        }

        /* Character Builder */
        .character-builder {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            border: 1px dashed var(--border);
        }

        /* Avatar Container with Dynamic Border Logic */
        .avatar-frame {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            border-radius: 50%;
            border: 4px solid var(--gold);
            box-shadow: 0 0 25px rgba(197, 160, 89, 0.4);
            overflow: hidden;
            background: #222;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            transition: all 0.5s ease;
        }

        /* High Tension State (Corrupted/Cracked Look) if > 80% */
        /* Dynamic class added via JS below */
        .avatar-frame.corrupted {
            border-color: var(--blood);
            border-style: dashed;
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0% {
                box-shadow: 0 0 15px rgba(138, 11, 11, 0.4);
            }

            50% {
                box-shadow: 0 0 25px rgba(138, 11, 11, 0.8);
            }

            100% {
                box-shadow: 0 0 15px rgba(138, 11, 11, 0.4);
            }
        }

        .tension-wrapper {
            margin-top: 15px;
            text-align: center;
        }

        .tension-track {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #555;
        }

        .tension-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--blood));
            transition: width 0.3s;
        }

        .adventure-log {
            margin-top: 40px;
            border-top: 2px solid var(--gold);
            padding-top: 20px;
        }

        .log-entry {
            background: rgba(0, 0, 0, 0.02);
            border-bottom: 1px dashed #ccc;
            padding: 10px;
            margin-bottom: 5px;
            font-family: 'Crimson Text';
            font-size: 1.1rem;
        }

        .log-entry:focus {
            background: rgba(255, 215, 0, 0.1);
            outline: none;
        }

        [contenteditable="true"]:hover {
            background-color: rgba(255, 255, 255, 0.1);
            cursor: text;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 10px;
            justify-items: center;
            margin-top: 20px;
        }

        /* Nav Tabs */
        .nav-tabs {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(22, 25, 32, 0.8);
            border: 1px solid var(--border);
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .nav-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            color: var(--accent);
        }

        .glow-btn {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
            border-color: rgba(212, 175, 55, 0.4);
            color: var(--accent);
        }

        .glow-btn:hover {
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 100%);
        }

        /* ========== MOBILE RESPONSIVE ========== */
        @media (max-width: 768px) {
            body {
                padding: 20px 12px;
            }

            .hero {
                margin-bottom: 30px;
            }

            .logo {
                font-size: 2.2rem;
                letter-spacing: 4px;
            }

            .tagline {
                font-size: 0.8rem;
                letter-spacing: 4px;
            }

            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header {
                margin-bottom: 10px !important;
            }

            .title {
                font-size: 1.3rem;
            }

            .subtitle {
                font-size: 0.8rem;
            }

            .lang-selector {
                padding: 8px 12px !important;
            }

            .lang-selector a {
                font-size: 1.3rem !important;
                margin: 0 5px !important;
            }

            .card {
                padding: 18px;
                border-radius: 16px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .card-desc {
                font-size: 0.8rem;
                margin-bottom: 15px;
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                font-size: 0.7rem;
                margin-bottom: 6px;
            }

            input,
            select {
                padding: 10px;
                font-size: 0.85rem;
            }

            .btn-forge {
                padding: 14px;
                font-size: 0.9rem;
                letter-spacing: 1px;
            }

            /* ===== FORCE ALL GRIDS TO SINGLE COLUMN ===== */
            .mobile-grid-stack,
            [style*="grid-template-columns: 1fr 1fr"],
            [style*="grid-template-columns: repeat(3"],
            [style*="grid-template-columns: repeat(2"] {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            /* Character row fields - stack vertically */
            .character-row {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 8px;
                margin-bottom: 15px !important;
            }

            .character-row>div:first-child {
                margin: 0 auto 5px auto;
            }

            /* Steps section - vertical */
            div[style*="repeat(3, 1fr)"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 20px !important;
            }

            div[style*="repeat(3, 1fr)"]>div {
                padding: 15px !important;
            }

            /* Feature list - single column */
            div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }

            /* Demo section grids */
            div[style*="grid-template-columns: 1fr 1fr"][style*="gap: 40px"] {
                display: block !important;
            }

            div[style*="grid-template-columns: 1fr 1fr"][style*="gap: 40px"]>div {
                margin-bottom: 20px;
            }

            /* Reduce margins on sections */
            div[style*="margin-top: 80px"] {
                margin-top: 40px !important;
            }

            div[style*="margin-top: 60px"] {
                margin-top: 30px !important;
            }

            /* Character builder scroll area */
            .character-builder {
                max-height: none !important;
                overflow-y: visible !important;
            }

            /* Version badge */
            .version {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            /* Credits display */
            #creditsDisplay {
                font-size: 0.8rem;
                padding: 6px 12px !important;
            }

            /* Price labels */
            [id*="priceLabel"] {
                font-size: 1rem !important;
            }

            /* Demo section titles */
            h2[style*="font-size: 2rem"] {
                font-size: 1.4rem !important;
            }

            h2[style*="font-size: 2.5rem"] {
                font-size: 1.6rem !important;
            }

            /* Quote blocks */
            p[style*="font-size: 1.2rem"] {
                font-size: 1rem !important;
            }
        }

        /* Extra small screens (phones in portrait) */
        @media (max-width: 480px) {
            body {
                padding: 15px 8px;
            }

            .logo {
                font-size: 1.6rem;
                letter-spacing: 2px;
            }

            .tagline {
                font-size: 0.65rem;
                letter-spacing: 2px;
            }

            .card {
                padding: 12px;
                border-radius: 12px;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .btn-forge {
                padding: 12px;
                font-size: 0.8rem;
            }

            input,
            select {
                padding: 8px;
                font-size: 0.8rem;
            }

            /* Hide less important sections on very small screens */
            .demo-section-hide-mobile {
                display: none;
            }
        }

        /* New Demo Card Style */
        .demo-card-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .demo-card {
            width: 380px;
            background: rgba(16, 18, 23, 0.95);
            border: 1px solid #333;
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-color: var(--accent);
        }

        .demo-img-wrapper {
            width: 100%;
            height: 250px;
            overflow: hidden;
            position: relative;
            border-bottom: 2px solid var(--accent-dim);
        }

        .demo-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .demo-card:hover .demo-img {
            transform: scale(1.05);
        }

        .demo-content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .demo-name {
            font-family: 'Cinzel', serif;
            font-size: 1.6rem;
            color: #fff;
            margin: 0;
        }

        .demo-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .demo-tag {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #aaa;
            text-transform: uppercase;
            font-weight: 600;
        }

        .btn-view-demo {
            width: 100%;
            background: var(--accent);
            color: #000;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .btn-view-demo:hover {
            background: var(--gold-bright);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            color: #000;
        }

        /* FAQ Section Styles */
        .faq-section {
            width: 100%;
            max-width: 900px;
            margin: 80px auto;
        }

        .faq-item {
            background: linear-gradient(90deg, rgba(20, 20, 25, 0.8) 0%, rgba(20, 20, 25, 0.4) 100%);
            border-left: 3px solid var(--accent);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }

        .faq-q {
            color: var(--text-main);
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-family: 'Cinzel', serif;
        }

        .faq-a {
            color: var(--text-dim);
            font-size: 0.95rem;
            line-height: 1.5;
        }
    </style>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>

<body>
    <!-- DEBUG BANNER TO CONFIRM UPDATE -->
    <!-- Removed red banner for clean look -->
    <div class="hero">
        <div class="logo-container">
            <img src="/static/images/logo_web.png" alt="SoulForge - Forja de Almas" class="logo-img">
        </div>
        <div class="tagline" data-i18n="hero_tagline">Sistema de Forja de Almas</div>
        <span class="version" style="color:#4ade80; font-weight:bold;">v4.1 - SISTEMA MODULAR (VIVO)</span>

        <!-- Credits Display -->
        <div id="creditsDisplay"
            style="margin-top: 20px; display: none; background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(34, 197, 94, 0.3); font-weight: bold;">
            üéÅ Modo Prueba: <span id="creditsCount">0</span> usos gratis restantes
        </div>
    </div>

    <!-- CREDITS DISPLAY (Floating) -->
    <div id="creditsDisplay"
        style="display:none; position:fixed; top:20px; right:20px; z-index:9999; background:rgba(0,0,0,0.9); border:1px solid #d4af37; padding:8px 15px; border-radius:30px; backdrop-filter:blur(5px); box-shadow:0 0 15px rgba(212,175,55,0.4); animation: fadeIn 0.5s;">
        <span style="color:#d4af37; font-family:'Cinzel'; font-weight:bold; font-size:0.9rem;"> <span
                style="font-size:1.2rem; margin-right:5px;">‚ö°</span> TOKENS:</span>
        <span id="creditsCount" style="color:#fff; font-weight:bold; margin-left:8px; font-size:1.2rem;">0</span>
    </div>

    <div class="container">
        <div class="header" style="grid-column: 1 / -1; margin-bottom: 20px;">
            <h1 class="title" data-i18n="index_title">Motor SoulForge</h1>

            <p class="subtitle" data-i18n="index_subtitle">Generaci√≥n Narrativa Procedural & Sistema de Psicolog√≠a
                Profunda</p>
            <div class="lang-selector"
                style="margin-top: 25px; background: rgba(0,0,0,0.4); display: inline-block; padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border);">
                <a href="#es" onclick="changeLanguage('es')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;"
                    title="Espa√±ol">üá™üá∏</a>
                <a href="#en" onclick="changeLanguage('en')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;"
                    title="English">üá∫üá∏</a>
                <a href="#jp" onclick="changeLanguage('jp')"
                    style="font-size:2rem; text-decoration:none; margin: 0 10px; cursor: pointer;" title="Êó•Êú¨Ë™û">üáØüáµ</a>
            </div>

            <!-- NAV TABS -->
            <div class="nav-tabs">
                <a href="sistema_habilidades.html" class="nav-btn glow-btn">
                    ‚ö° Sistema de Talentos <span style="font-size: 0.7rem; display: block; color: #4ade80;">Ver C√≥mo
                        Funciona</span>
                </a>
                <button type="button" class="nav-btn" style="opacity: 0.5; cursor: not-allowed;" disabled>
                    üéÆ Jugar en L√≠nea (VTT) <span style="font-size: 0.7rem; display: block; color: #d4af37;">Coming
                        Soon</span>
                </button>
                <button type="button" class="nav-btn" style="opacity: 0.5; cursor: not-allowed;" disabled>
                    üíÄ Muro de los Ca√≠dos <span style="font-size: 0.7rem; display: block; color: #d4af37;">Coming
                        Soon</span>
                </button>
                <a href="editor_libros.html" class="nav-btn glow-btn">
                    ‚úçÔ∏è Escribir Historia <span style="font-size: 0.7rem; display: block; color: #4ade80;">SoulForge
                        Writer</span>
                </a>
                <button type="button" class="nav-btn" onclick="showLogin()" id="loginBtn">
                    üë§ Iniciar Sesi√≥n <span style="font-size: 0.7rem; display: block; color: var(--accent);">Acceder a
                        Santuario</span>
                </button>
            </div>
        </div>

        <!-- PERSONAJE √öNICO -->
        <div class="card">
            <h2 class="card-title" data-i18n="card_alma_title">‚öîÔ∏è Forjar Alma</h2>
            <p class="card-desc" data-i18n="card_alma_desc">Crea un personaje √∫nico con profundidad psicol√≥gica.</p>

            <form id="formPersonaje" onsubmit="return handleForjarAlma(event)">
                <input type="hidden" name="lang" id="inputLangPersonaje" value="es">
                <div class="form-group">
                    <label data-i18n="label_nombre">NOMBRE DEL PERSONAJE</label>
                    <input type="text" name="nombre" id="inputNombre" data-i18n-placeholder="label_nombre_placeholder"
                        placeholder="Ej: Kael (vac√≠o = aleatorio)">
                </div>

                <div class="mobile-grid-stack" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label data-i18n="genero">G√âNERO</label>
                        <select name="genero">
                            <option value="">-- Aleatorio --</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="rol">ROL</label>
                        <select name="rol" id="rolSelect" onchange="toggleRaceField()">
                            <option value="">-- Aleatorio --</option>
                            <option value="Heroe">H√©roe</option>
                            <option value="Villano">Villano</option>
                            <option value="Mentor">Mentor</option>
                            <option value="Aliado">Aliado</option>
                            <option value="Jugador">‚ú® Jugador (D&D/RPG)</option>
                            <option value="Bufon">Buf√≥n</option>
                            <option value="Victima">V√≠ctima</option>
                            <option value="Profeta">Profeta</option>
                            <option value="Guardian">Guardi√°n</option>
                            <option value="Embaucador">Embaucador</option>
                        </select>
                    </div>

                    <!-- NEW CLASS SELECTOR -->
                    <div class="form-group">
                        <label data-i18n="label_clase">CLASE / OFICIO</label>
                        <select name="clase" id="claseSelect">
                            <option value="">-- Aleatorio / Sorpresa --</option>
                            <option value="Guerrero">Guerrero</option>
                            <option value="Mago">Mago</option>
                            <option value="Picaro">P√≠caro</option>
                            <option value="Clerigo">Cl√©rigo</option>
                            <option value="Paladin">Palad√≠n</option>
                            <option value="Barbaro">B√°rbaro</option>
                            <option value="Bardo">Bardo</option>
                            <option value="Druida">Druida</option>
                            <option value="Monje">Monje</option>
                            <option value="Artificiero">Artificiero</option>
                            <option value="Cazador">Cazador</option>
                            <option value="Brujo">Brujo</option>
                            <option value="Hechicero">Hechicero</option>
                            <option value="Necromancer">Nigromante</option>
                        </select>
                    </div>

                    <div class="form-group" id="razaGroup" style="display: none;">
                        <label>Raza (D&D)</label>
                        <select name="raza">
                            <option value="">-- Aleatorio --</option>
                            <option value="Humano">Humano</option>
                            <option value="Elfo">Elfo</option>
                            <option value="Enano">Enano</option>
                            <option value="Halfling">Halfling</option>
                            <option value="Dragonborn">Dragonborn</option>
                            <option value="Gnomo">Gnomo</option>
                            <option value="Tiefling">Tiefling</option>
                            <option value="Orco">Orco</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label data-i18n="edad">EDAD</label>
                    <input type="number" name="edad_fija" placeholder="30 (Opcional)" min="5" max="900">
                </div>

                <div class="form-group">
                    <label data-i18n="label_mundo">MUNDO</label>
                    <select name="mundo">
                        <option value="FantasiaMedieval">Fantas√≠a Medieval</option>
                        <option value="FantasiaOscura">Fantas√≠a Oscura</option>
                        <option value="FantasiaUrbana">Fantas√≠a Urbana</option>
                        <option value="SciFiCyberpunk">Cyberpunk</option>
                        <option value="SciFiSpace">Sci-Fi Space Opera</option>
                        <option value="SciFiPostApocaliptico">Post-Apocal√≠ptico</option>
                        <option value="Steampunk">Steampunk</option>
                        <option value="Western">Western</option>
                        <option value="Noir">Noir / Detectives</option>
                        <option value="Realista">Realista</option>
                        <option value="JaponFeudal">Jap√≥n Feudal</option>
                        <option value="ChinaImperial">China Imperial</option>
                        <option value="CoreaHistorica">Corea Hist√≥rica</option>
                        <option value="MitologiaAsiatica">Mitolog√≠a Asi√°tica</option>
                        <option value="AnimeFantasia">Anime Fantas√≠a</option>
                        <option value="Wuxia">Wuxia</option>
                        <option value="Victoriano">Era Victoriana</option>
                        <option value="MitologiaGriega">Mitolog√≠a Griega</option>
                        <option value="MitologiaNordica">Mitolog√≠a N√≥rdica</option>
                        <option value="PiratasCaribe">Piratas</option>
                    </select>
                </div>

                <div class="form-group">
                    <label data-i18n="label_tono">TONO</label>
                    <select name="tono_moral">
                        <option value="">-- Aleatorio --</option>
                        <option value="Luminoso">Luminoso/Bueno</option>
                        <option value="Gris">Gris/Moral Ambigua</option>
                        <option value="Oscuro">Oscuro</option>
                    </select>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="submit" id="btnPersonaje" class="btn-forge">
                        <span style="font-size: 1.2rem;">‚ö°</span> <span data-i18n="btn_forjar_alma">FORJAR ALMA</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- CONSTELACI√ìN (HIDDEN TEMPORARILY) -->
        <div class="card" style="display:none">
            <h2 class="card-title" data-i18n="card_constelacion_title">üåå Forjar Constelaci√≥n</h2>
            <p class="card-desc" data-i18n="card_constelacion_desc">Genera un grupo de personajes interconectados.</p>

            <form id="formConstelacion" onsubmit="return handleForjarConstelacion(event)">
                <input type="hidden" name="lang" id="inputLangConstelacion" value="es">
                <input type="hidden" name="nombres" id="nombresHidden">
                <input type="hidden" name="generos" id="generosHidden">
                <input type="hidden" name="edades" id="edadesHidden">

                <!-- Slider de cantidad -->
                <div class="form-group">
                    <label data-i18n="label_tamano_grupo">TAMA√ëO DEL GRUPO</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="range" name="cantidad" id="cantidadSlider" min="2" max="4" value="3"
                            oninput="updateCharacterFields()" style="flex: 1;">
                        <span id="cantidadValue"
                            style="font-weight: bold; color: var(--accent); width: 30px; text-align: center; font-size: 1.2rem;">3</span>
                    </div>
                </div>

                <!-- Campos din√°micos de personajes -->
                <div class="character-builder" style="max-height: 250px; overflow-y: auto; margin-bottom: 20px;">
                    <h4 style="color: var(--text-dim); margin-bottom: 15px;" data-i18n="label_personalizar">Personalizar
                    </h4>
                    <div id="characterFields">
                        <!-- JS llenar√° esto -->
                    </div>
                </div>

                <!-- Opciones avanzadas -->
                <div class="mobile-grid-stack" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label data-i18n="label_motivacion_villano">MOTIVACI√ìN DEL VILLANO</label>
                        <select name="tipo_villano">
                            <option value="None">Aleatorio / Ninguna</option>
                            <option value="Envidia">Envidia</option>
                            <option value="Ideologia">Ideolog√≠a</option>
                            <option value="Obstaculo">Obst√°culo</option>
                            <option value="PuraMaldad">Pura Maldad</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_romance">ROMANCE</label>
                        <select name="modo_romance">
                            <option value="None">Aleatorio / Ninguno</option>
                            <option value="Pareja">Pareja</option>
                            <option value="Triangulo">Tri√°ngulo</option>
                            <option value="AmorProhibido">Amor Prohibido</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_mundo">MUNDO</label>
                        <select name="mundo">
                            <option value="FantasiaMedieval">Fantas√≠a Medieval</option>
                            <option value="FantasiaOscura">Fantas√≠a Oscura</option>
                            <option value="FantasiaUrbana">Fantas√≠a Urbana</option>
                            <option value="SciFiCyberpunk">Cyberpunk</option>
                            <option value="SciFiSpace">Sci-Fi Space Opera</option>
                            <option value="SciFiPostApocaliptico">Post-Apocal√≠ptico</option>
                            <option value="Steampunk">Steampunk</option>
                            <option value="Western">Western</option>
                            <option value="Noir">Noir / Detectives</option>
                            <option value="Realista">Realista</option>
                            <option value="JaponFeudal">Jap√≥n Feudal</option>
                            <option value="ChinaImperial">China Imperial</option>
                            <option value="CoreaHistorica">Corea Hist√≥rica</option>
                            <option value="MitologiaAsiatica">Mitolog√≠a Asi√°tica</option>
                            <option value="AnimeFantasia">Anime Fantas√≠a</option>
                            <option value="Wuxia">Wuxia</option>
                            <option value="Victoriano">Era Victoriana</option>
                            <option value="MitologiaGriega">Mitolog√≠a Griega</option>
                            <option value="MitologiaNordica">Mitolog√≠a N√≥rdica</option>
                            <option value="PiratasCaribe">Piratas</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label data-i18n="label_densidad">DENSIDAD</label>
                        <select name="densidad_relaciones">
                            <option value="Normal">Normal</option>
                            <option value="Densa">Densa</option>
                            <option value="Dispersa">Dispersa</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="submit" id="btnConstelacion" class="btn-forge" onclick="prepareSubmit()">
                        <span style="font-size: 1.2rem;">‚ö°</span> <span data-i18n="btn_forjar_constelacion">FORJAR
                            CONSTELACI√ìN</span>
                    </button>
                    <p style="color: var(--text-dim); font-size: 0.8rem; margin-top: 10px;">
                        El proceso inicia inmediatamente.
                    </p>
                </div>
            </form>
        </div>
    </div>



    <!-- HOW IT WORKS SECTION -->
    <div style="width: 100%; max-width: 1200px; margin-top: 80px;">
        <div style="text-align: center; margin-bottom: 50px;">
            <h2 style="font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 15px;"
                data-i18n="how_it_works_title">¬øC√≥mo Funciona?</h2>
            <p style="color: var(--text-dim); font-size: 1.1rem;" data-i18n="how_it_works_subtitle">Tu viaje de la
                idea al personaje.</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px;">
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">‚öôÔ∏è</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step1_title">1. Configura</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step1_desc">Elige g√©nero, mundo... o
                    d√©jalo al azar.</p>
            </div>
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">üî•</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step2_title">2. Forja</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step2_desc">La IA genera psicolog√≠a
                    profunda e historia.</p>
            </div>
            <div
                style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--border);">
                <div style="font-size: 3rem; margin-bottom: 20px;">üì•</div>
                <h3 style="color: var(--text-main); margin-bottom: 15px;" data-i18n="step3_title">3. Descarga</h3>
                <p style="color: var(--text-dim); line-height: 1.6;" data-i18n="step3_desc">Obt√©n una ficha HTML premium
                    lista para usar.</p>
            </div>
        </div>
    </div>


    <!-- CHARACTER DEMOS SECTION (MOTOR VISUAL) -->
    <div style="width: 100%; max-width: 1200px; margin-top: 100px;">
        <div style="text-align: center; margin-bottom: 50px;">
            <h2 style="font-family: 'Cinzel', serif; font-size: 2.5rem; color: var(--accent); margin-bottom: 15px;"
                data-i18n="demos_title">Ejemplos de Personajes</h2>
            <p style="color: var(--text-dim); font-size: 1.1rem;" data-i18n="demos_subtitle">Mira la profundidad y
                complejidad.</p>
        </div>

        <!-- HIERARCHY EXPLANATION BOX -->
        <div
            style="background: rgba(0,0,0,0.3); padding: 30px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 40px; text-align: left; max-width: 900px; margin-left: auto; margin-right: auto;">
            <h3
                style="font-family:'Cinzel'; color: var(--text-main); border-left: 4px solid var(--accent); padding-left: 15px; margin-bottom: 20px;">
                <span data-i18n="hierarchy_title">üèÜ Jerarqu√≠a de Poder</span>
            </h3>
            <p style="color: var(--text-dim); line-height: 1.8; margin-bottom: 20px;" data-i18n="hierarchy_desc">
                El sistema de cartas no es solo est√©tico; define el potencial narrativo y mec√°nico de tu personaje.
                Las cartas de alto nivel (SSS) no solo otorgan mejores estad√≠sticas, sino que alteran las reglas del
                juego.
            </p>
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span
                        style="width: 10px; height: 10px; background: #2E8B57; border-radius: 50%; margin-right: 15px; box-shadow: 0 0 10px #2E8B57;"></span>
                    <span style="color: #aaa;" data-i18n="class_eco"><strong style="color: #2E8B57;">Clase Eco
                            (C-B):</strong> Sobrevivientes.
                        Stats base. Tecnolog√≠a est√°ndar.</span>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span
                        style="width: 10px; height: 10px; background: #d4af37; border-radius: 50%; margin-right: 15px; box-shadow: 0 0 10px #d4af37;"></span>
                    <span style="color: #aaa;" data-i18n="class_shadow"><strong style="color: var(--accent);">Clase
                            Sombra (A):</strong> Agentes
                        de √©lite. Acceso a perks ocultos.</span>
                </li>
                <li style="margin-bottom: 10px; display: flex; align-items: center;">
                    <span
                        style="width: 10px; height: 10px; background: #800080; border-radius: 50%; margin-right: 15px; box-shadow: 0 0 10px #800080;"></span>
                    <span style="color: #aaa;" data-i18n="class_primordial"><strong style="color: #c026d3;">Clase
                            Primordial (SSS):</strong>
                        Entidades c√≥smicas. Rompen las reglas.</span>
                </li>
            </ul>
        </div>

        <div class="demo-card-container">
            <!-- Demo 1: Azraell (SSS) -->
            <a href="#" onclick="openDemo(event, 'demo_sss_strict.html')" class="demo-card"
                style="text-decoration: none; border-color: #800080; box-shadow: 0 0 20px rgba(128,0,128,0.2);">
                <div class="demo-img-wrapper">
                    <img src="/static/images/preview_ficha_eldric.png" class="demo-img" alt="Azraell Sheet Preview">
                    <div
                        style="position:absolute; top:10px; right:10px; background:#800080; color:white; padding:4px 12px; font-size:0.8rem; font-weight:bold; border-radius:4px; box-shadow:0 0 10px #800080;">
                        SSS ¬∑ LEGENDARIO</div>
                </div>
                <div class="demo-content">
                    <h3 class="demo-name"
                        style="background: linear-gradient(to right, #c026d3, #7e22ce); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"
                        data-i18n="demo_1_name">Azraell, Entidad C√≥smica</h3>
                    <div class="demo-tags">
                        <span class="demo-tag" style="border-color:#800080; color:#d88;"
                            data-i18n="tag_dark_fantasy">Fantas√≠a Oscura</span>
                        <span class="demo-tag" data-i18n="tag_lvl_20">Nivel 20</span>
                        <span class="demo-tag" style="border-color: #ffd700; color:#ffd700;"
                            data-i18n="tag_epic">√âpico</span>
                    </div>
                    <p style="text-align:center; color:var(--accent); margin-top:10px; font-size:0.9rem;">
                        <span data-i18n="demo_click_cta">VER FICHA COMPLETA</span> ‚ú®
                    </p>
                </div>
            </a>

            <!-- Demo 2: Elara (Standard) -->
            <a href="#" onclick="openDemo(event, 'demo_elara.html')" class="demo-card"
                style="text-decoration: none; border-color: #2E8B57;">
                <div class="demo-img-wrapper">
                    <img src="static/images/preview_ficha_elara.png" class="demo-img" alt="Elara Sheet Preview">
                    <div
                        style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.8); color:#2E8B57; padding:2px 8px; font-size:0.7rem; font-weight:bold; border:1px solid #2E8B57; border-radius:4px;">
                        CYBERPUNK</div>
                </div>
                <div class="demo-content">
                    <h3 class="demo-name" style="color:#2E8B57;" data-i18n="demo_2_name">Elara Vex</h3>
                    <div class="demo-tags">
                        <span class="demo-tag" data-i18n="tag_human">Humana</span>
                        <span class="demo-tag" data-i18n="tag_lvl_5">Nivel 5</span>
                        <span class="demo-tag" style="border-color: #2E8B57; color:#8fbc8f;"
                            data-i18n="tag_hacker">Hacker</span>
                    </div>
                    <p style="text-align:center; color:var(--accent); margin-top:10px; font-size:0.9rem;">
                        <span data-i18n="demo_click_cta">VER FICHA COMPLETA</span> ‚ö°

                </div>
            </a>
        </div>
    </div>
    </div>

    <!-- Firebase Login Container -->
    <div id="login-modal"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:10000; align-items:center; justify-content:center; backdrop-filter:blur(15px);">
        <div class="card"
            style="max-width:400px; width:90%; position:relative; border: 2px solid var(--accent); box-shadow: 0 0 50px rgba(212, 175, 55, 0.2); background: radial-gradient(circle at top, #161920, #080a0e);">
            <button onclick="document.getElementById('login-modal').style.display='none'"
                style="position:absolute; top:20px; right:20px; background:none; border:none; color:var(--text-dim); cursor:pointer; font-size:1.8rem; transition: 0.3s;"
                onmouseover="this.style.color='var(--accent)'"
                onmouseout="this.style.color='var(--text-dim)'">&times;</button>

            <div style="text-align:center; margin-bottom: 30px;">
                <div style="font-size: 3rem; margin-bottom: 10px;">üõ°Ô∏è</div>
                <h2 class="card-title"
                    style="text-align:center; border:none; padding:0; margin:0; font-size: 1.5rem; letter-spacing: 2px;">
                    IDENTIFICACI√ìN DE ALMA</h2>
                <div style="height: 1px; width: 60px; background: var(--accent); margin: 15px auto; opacity: 0.5;">
                </div>
                <p class="card-desc" style="text-align:center; font-size: 0.9rem; margin: 0; color: var(--text-main);">
                    Accede a la sabidur√≠a del Bibliotecario Daithon para salvaguardar tu progreso.</p>
            </div>

            <div id="auth-buttons" style="display: flex; flex-direction: column; gap: 15px;">
                <!-- Custom Premium Google Button -->
                <button onclick="loginWithGoogle()"
                    style="display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 14px; background: #fff; color: #000; border: none; border-radius: 12px; font-family: 'Inter', sans-serif; font-weight: 600; cursor: pointer; transition: 0.3s; transform: perspective(1px) translateZ(0);">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"
                        height="20">
                    Continuar con Google
                </button>

                <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                    <div style="flex:1; height:1px; background: rgba(255,255,255,0.1);"></div>
                    <span
                        style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;">o
                        mediante sello</span>
                    <div style="flex:1; height:1px; background: rgba(255,255,255,0.1);"></div>
                </div>

                <button onclick="loginWithEmail()"
                    style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); color: var(--text-main); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; font-size: 0.85rem; cursor: pointer; transition: 0.3s;">
                    Identificaci√≥n por Email
                </button>
            </div>

            <p id="login-error"
                style="display:none; color: #ff4d4d; font-size: 0.8rem; text-align: center; margin-top: 20px; background: rgba(255, 77, 77, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(255, 77, 77, 0.2);">
            </p>
        </div>
    </div>

    <!-- MODULAR JS ARCHITECTURE -->
    <script type="module" src="js/main.js?v=4.5"></script>
    <script type="module" src="js/ui.js?v=4.5"></script>

    <script>
        // === LOGIN LOGIC ===
        function showLogin() {
            document.getElementById('login-modal').style.display = 'flex';
        }

        async function loginWithGoogle() {
            if (window.location.protocol === 'file:') {
                const errorEl = document.getElementById('login-error');
                errorEl.textContent = "‚ö†Ô∏è El inicio de sesi√≥n con Google no funciona desde archivos locales (file://). Por favor, abre esta p√°gina desde un servidor local (ej: Live Server) o desde la URL de despliegue.";
                errorEl.style.display = 'block';
                return;
            }

            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                console.log("Login exitoso:", result.user.displayName);
                window.location.href = 'editor_libros.html';
            } catch (error) {
                console.error("Error en Google Login:", error);
                const errorEl = document.getElementById('login-error');

                if (error.code === 'auth/api-key-not-valid') {
                    errorEl.textContent = "‚ùå Error t√©cnico: La API Key de Firebase no es v√°lida. Por favor, verifica la configuraci√≥n en la consola de Firebase.";
                } else if (error.code === 'auth/popup-blocked') {
                    errorEl.textContent = "‚ùå El navegador bloque√≥ la ventana emergente. Por favor, permite las ventanas emergentes para este sitio.";
                } else {
                    errorEl.textContent = "‚ùå Error: " + (error.message || "No se pudo iniciar sesi√≥n con Google.");
                }
                errorEl.style.display = 'block';
            }
        }

        async function loginWithEmail() {
            const email = prompt("Ingresa tu email:");
            if (email) {
                alert("La identificaci√≥n por email est√° desactivada temporalmente por mantenimiento. Por favor usa Google.");
            }
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                console.log("Usuario identificado:", user.uid);
                const userRef = db.collection('usuarios').doc(user.uid);
                const doc = await userRef.get();

                let currentPlan = "gratis";

                if (!doc.exists) {
                    // PRIMER LOGIN: REGALO DE 7 D√çAS PRO
                    const trialEnd = new Date();
                    trialEnd.setDate(trialEnd.getDate() + 7);

                    const userData = {
                        uid: user.uid,
                        email: user.email,
                        plan_activo: "pro",
                        trial_active: true,
                        fecha_expiracion: firebase.firestore.Timestamp.fromDate(trialEnd),
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        created_at: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await userRef.set(userData);
                    currentPlan = "pro";
                    alert("¬°Bienvenido Iniciado! Se te ha otorgado el Plan Pro por 7 d√≠as como regalo de bienvenida.");
                } else {
                    const data = doc.data();
                    currentPlan = data.plan_activo;

                    // Verificar expiraci√≥n
                    if (currentPlan === "pro" && data.fecha_expiracion) {
                        const now = new Date();
                        const exp = data.fecha_expiracion.toDate();
                        if (now > exp) {
                            currentPlan = "gratis";
                            await userRef.update({ plan_activo: "gratis", trial_active: false });
                            alert("Tu periodo Pro ha expirado. Has vuelto al plan Novato.");
                        }
                    }
                }

                localStorage.setItem('soulforge_tier', currentPlan);
                localStorage.setItem('soulforge_uid', user.uid);
            } else {
                localStorage.setItem('soulforge_tier', 'gratis');
                localStorage.removeItem('soulforge_uid');
            }
        });

        // Global function for demos
        window.openDemo = function (event, url) {
            event.preventDefault();
            const lang = localStorage.getItem('soulforge_lang') || 'es';
            window.open(url + '#' + lang, '_blank');
        }

        // Add login button to header area if needed, or trigger via hero
        document.addEventListener('DOMContentLoaded', () => {
            // If hash is #login, show it immediately
            if (window.location.hash === '#login') showLogin();
        });
    </script>
</body>

</html>